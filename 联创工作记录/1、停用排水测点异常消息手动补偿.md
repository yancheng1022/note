# 1、背景

2024-04-05 03:35:00 ~ 2024-04-05 05:40:00这一时间段内停用排水测点异常信息消息队列（ monitordata__psl__drainagealarm__bjlcgk ）导致煤矿（阳泉煤业股份有限公司五矿选煤厂），编码（140303012954），。测点编码（140006001-B301）名称（硐底水泵房排水管道（上））。只上报了开始时间，未上报结束时间。为了保证数据规整，需要手动补偿结束时间。

# 2、水泵开停时间数据项

|        |          |                             |
| ------ | -------- | --------------------------- |
| **序号** | **字段名称** | **说明**                      |
| 1      | 测点编码     | 必填，字符类型，总长度不超过28字符          |
| 2      | 水泵名称     | 必填，字符类型，总长不超100字符           |
| 3      | 异常类型     | 必填，字典值                      |
| 4      | 异常内容     | 必填，字符类型                     |
| 5      | 异常发生时间   | 必填，数据格式yyyy-MM-dd HH:mm:ss  |
| 6      | 预警等级     | 必填，数值，1(红)、2(橙)、3(黄)、4(蓝)   |
| 7      | 异常原因     | 必填，不超过1000                  |
| 8      | 异常录入人员   | 必填，字符                       |
| 9      | 异常结束时间   | 必填项，数据格式yyyy-MM-dd HH:mm:ss |
| 10     | 数据时间     | 必填项，数据格式yyyy-MM-dd HH:mm:ss |

  

# 3、补偿方案

使用kafka客户端手动发送水泵关停消息

## 3.1、消息格式

消息内容包括两部分:消息头和消息体

消息头包括煤矿编码、矿井名称和数据上传时间。这3个字段都是必填项。其中数据上传时间是首省局生成消息的时间。

文件体是煤矿所有排水监测系统1天排水量异常数据的集合

【示例】：

消息头

煤矿编码：140303012954;

矿井名称：阳泉煤业股份有限公司五矿选煤厂;

数据上传时间：2024-04-05 03:36:30~

  

消息体

测点编码：14030301295405MN05046001B301;

排水点位置：硐底水泵房排水管道（上）;

异常类型：128;

异常内容：日环比值-13.429<阈值（红）0.0;

异常发生时间：2024-04-05 03:35:00;

预警等级：1;

异常原因：;

异常录入人员：;

异常结束时间：;

数据时间：2024-04-05 03:35:00~

TDengine数据格式：

```
{
    "mineCode": "140303012954",
    "reportContent": "140303012954;阳泉煤业股份有限公司五矿选煤厂;2024-04-05 03:36:30~14030301295405MN05046001B301;硐底水泵房排水管道（上）;128;日环比值-13.429<阈值（红）0.0;2024-04-05 03:35:00;1;;;;2024-04-05 03:35:00~",
    "reportFileName": "140303012954_PSLCDYC_20240405033630",
    "secretKey": "lantrackkey",
    "type": "err_data",
    "uptime": "2024-04-05 03:36:30"
}
```

## 3.2、具体流程

1、连接客户端

./kafka-console-producer.sh broker-list --bootstrap-server localhost:9092 --topic monitordata__psl__drainagealarm__bjlcgk

2、数据上报

140303012954;阳泉煤业股份有限公司五矿选煤厂;2024-04-05 05:40:00~14030301295405MN05046001B301;硐底水泵房排水管道（上）;128;日环比值-13.429<阈值（红）0.0;2024-04-05 05:40:00;1;;;2024-04-05 05:40:00;2024-04-05 05:40:00~