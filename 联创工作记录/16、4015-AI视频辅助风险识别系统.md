# 1、方案

## 1.1、北小菜

代码地址： https://gitee.com/Vanishi/BXC_VideoAnalyzer_v4/

文档：https://beixiaocai.yuque.com/org-wiki-beixiaocai-vo72oa/xcms/69315a530fd4a0664d989be2618ca982

## 1.2、wgai

https://github.com/YeyuchenBa/wgai?tab=readme-ov-file

太杂

## 1.3、BrainFrame（科大讯飞）

https://www.xfyun.cn/solutions/video/?isZc=1

## 1.4、yolo-onnx-java
https://gitee.com/agricultureiot/yolo-onnx-java

## 1.5、JavaVision

https://github.com/javpower/JavaVision

耦合性太高


## 1.6、java_pytorch_onnx_tensorrt_yolov8_vue

https://github.com/xiaoyeshenger/java_pytorch_onnx_tensorrt_yolov8_vue?tab=readme-ov-file

SpringBoot+Docker+Cuda+Cudnn+Pythorch+Onnx+Tensorrt+Yolov8+ffmpeg+zlmediakit 的AI算法中台系统，本系统主要实现JAVA调用Python脚本的方式，实现在英伟达GPU上进行yolov8的onnx或tensorrt的推理运算，实现火灾烟雾等视频的识别，并将识别结果通过ffmpeg推流到zlmediakit流媒体服务器。


rocket启动

export PYTHONPATH=$PYTHONPATH:/usr/local/lib/python3.6/site-packages/django

## 1.2、问题

# 2、部署video-analyzer

## 2.1、安装python3.9


```shell
# 安装依赖软件包：
sudo yum install -y gcc openssl-devel bzip2-devel libffi-devel
# 下载源码
wget https://www.python.org/ftp/python/3.9.0/Python-3.9.0.tgz
# 解压
tar -xf Python-3.9.0.tgz
# 进入解压后目录
cd Python-3.9.0
# 配置和编译安装python
./configure
make && sudo make altinstall
# 查看状态
python3.9 --version
```

## 2.2、部署Admin

```shell
# 创建虚拟环境
python3.9 -m venv venv
# 激活虚拟环境
source venv/bin/activate
# 更新虚拟环境的pip版本
python3.9 -m pip install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple
# 在虚拟环境中安装依赖库
python3.9 -m pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
# 启动后台管理服务
python3.9 manage.py runserver 0.0.0.0:9001
```

## 2.3、部署流媒体服务器Zlmediakit

安装Zlmediakit流媒体服务器，安装方法如下:

```shell
(1).拉取docker镜像
docker pull zlmediakit/zlmediakit:master

(2).创建目录以存放zlmediakit数据
mkdir -p /home/docker/zlmediakit && chmod 777 /home/docker/zlmediakit

(3).运行镜像
    --1.先运行镜像得到配置文件
    docker run --name zlmediakit -d zlmediakit/zlmediakit:master

    --2.复制 zlmediakit 容器文件到指定目录
    docker cp -a zlmediakit:/opt/media /home/docker/zlmediakit

    --3.删除 zlmediakit 容器
    docker rm -f zlmediakit

    --4.重新按自定义方式运行
    docker run --name zlmediakit --restart=always --env MODE=standalone -e TZ="Asia/Shanghai" \
        -v /home/docker/zlmediakit/media/bin:/opt/media/bin \
        -v /home/docker/zlmediakit/media/conf:/opt/media/conf \
        -p 11935:1935 -p 11080:80 -p 11554:554 \
        -p 11000:10000 -p 11000:10000/udp -p 18000:8000/udp \
        -p 50000-50300:50000-50300/udp \
        -d zlmediakit/zlmediakit:master
```

## 2.4、模拟推流

```shell
ffmpeg -re -stream_loop -1  -i test.mp4  -rtsp_transport tcp -c copy -f rtsp rtsp://192.168.7.92:11554/live/test
```

## 2.5、Analyzer的linux部署

### 2.5.1、安装ffmpeg(编译安装)

1、安装ffmpeg依赖

```shell
# 第一步：使用命令行安装ffmpeg依赖库，如果linux系统不支持命令行安装如下依赖库，那就需要手动编译安装了
sudo apt install yasm libfaac-dev libmp3lame-dev libopus-dev libx264-dev libx265-dev libtheora-dev libvorbis-dev libxvidcore-dev  libxext-dev libxfixes-dev

如遇错误，需要安装pkg-config：WARNING: pkg-config not found, library detection may fail
sudo apt install pkg-config

# 第二步：编译安装
# 1，解压
unzip FFmpeg-release-6.0.zip
# 2，切换到根目录
cd FFmpeg-release-6.0
# 3，执行如下命令（构建编译）
./configure  --prefix=/usr/local --enable-pic --enable-shared --disable-yasm --enable-gpl  --enable-nonfree  --enable-pthreads
4，执行编译
make
5，安装
sudo make install
# 6、检查
ffmpeg -version

如果出现报错：
ffmpeg: error while loading shared libraries: libavdevice.so.60: cannot open shared object file: No such file or directory

find /usr -name 'libavdevice.so.58'
export LD_LIBRARY_PATH=/usr/local/lib/
```

## 2.5.2、opencv

https://blog.csdn.net/weixin_57018576/article/details/140291190

### 2.5.3、jsoncpp

### 2.5.4、cmake升级

3.16.2

https://blog.csdn.net/qq_45112637/article/details/140195932

gcc升级

Centos7快速安装gcc8.3.1 可支持C++17（附gcc相关链接整理）
centos7直接yum安装的那个gcc版本为4.8.5，对于大多数的需求来说都是低了。系统安装镜像里的那个版本也是4.8.5。 在g++ 7 以上的版本中添加了对c++17 的支持，所以为了工作需要现在需要升级到高版本。

sudo yum install centos-release-scl
sudo yum install devtoolset-8-gcc*
scl enable devtoolset-8 bash
source /opt/rh/devtoolset-8/enable
1
2
3
4
后边执行mv命令的时候如果报错不用太过惊慌，这几句是用来替换掉直接安装的4.8.5版本的，但是没安装4.8.5软链接建立的命令也还是要执行的。

mv /usr/bin/gcc /usr/bin/gcc-4.8.5
ln -s /opt/rh/devtoolset-8/root/bin/gcc /usr/bin/gcc
mv /usr/bin/g++ /usr/bin/g++-4.8.5
ln -s /opt/rh/devtoolset-8/root/bin/g++ /usr/bin/g++
mv /usr/bin/c++ /usr/bin/c++-4.8.5
ln -s /opt/rh/devtoolset-8/root/bin/c++ /usr/bin/c++
1
2
3
4
5
6
可以查看一下版本看看了

gcc --version
g++ --version
c++ --version

ubuntu16.04安装gcc-8 g++8.0



openvino

https://blog.csdn.net/weixin_42904656/article/details/135287152


# 3、自己实现


## 3.1、部署流媒体服务器Zlmediakit

安装Zlmediakit流媒体服务器，安装方法如下:

```shell
(1).拉取docker镜像
docker pull zlmediakit/zlmediakit:master

(2).创建目录以存放zlmediakit数据
mkdir -p /home/docker/zlmediakit && chmod 777 /home/docker/zlmediakit

(3).运行镜像
    --1.先运行镜像得到配置文件
    docker run --name zlmediakit -d zlmediakit/zlmediakit:master

    --2.复制 zlmediakit 容器文件到指定目录
    docker cp -a zlmediakit:/opt/media /home/docker/zlmediakit

    --3.删除 zlmediakit 容器
    docker rm -f zlmediakit

    --4.重新按自定义方式运行
    docker run --name zlmediakit --restart=always --env MODE=standalone -e TZ="Asia/Shanghai" \
        -v /home/docker/zlmediakit/media/bin:/opt/media/bin \
        -v /home/docker/zlmediakit/media/conf:/opt/media/conf \
        -p 11935:1935 -p 11080:80 -p 11554:554 \
        -p 11000:10000 -p 11000:10000/udp -p 18000:8000/udp \
        -p 50000-50300:50000-50300/udp \
        -d zlmediakit/zlmediakit:master
```

## 3.2、模拟推流

```shell
ffmpeg -re -stream_loop -1  -i test.mp4  -rtsp_transport tcp -c copy -f rtsp rtsp://192.168.7.92:11554/live/test
```
