# 1、概况

## 1.1、基本信息

代码地址： https://gitee.com/Vanishi/BXC_VideoAnalyzer_v4/

文档：https://beixiaocai.yuque.com/org-wiki-beixiaocai-vo72oa/xcms/69315a530fd4a0664d989be2618ca982

## 1.2、问题

1、授权 单机 550 普通

流媒体协议：

rtmp：实时通话传输协议。协议的主要优点包括低延迟、实时性和高度可靠性。这些特点使得它成为在线游戏、视频直播和虚拟现实等领域的理想选择。然而，RTMP 的缺点是它主要依赖于 Adobe Flash 技术，这使得在移动设备和浏览器中的支持受到限制

rtsp：实时应用层协议。种应用层控制协议，用于在客户端和服务器之间建立、管理和控制实时媒体会话。RTSP 协议主要用于音频和视频流的点播和实时播放，而不是实时通信。RTSP 提供了一种基于文本的命令行接口，使得服务器和客户端可以方便地控制媒体流的播放、暂停、快进和音量调整等操作

# 2、分析系统接口

## 2.1、接收报警信息接口（4015）

```json
{
    'controlCode': 'C70cf305969407',//该报警数据所属布控的编号
    'streamApp': 'live',  //该报警数据所属报警摄像头的转发app
    'streamName': 'test', //该报警数据所属报警摄像头的转发name
    'streamCode': 'live_test', //该报警数据所属报警摄像头的编号
    'streamNickname': 'live_test',//该报警数据所属报警摄像头的自定义名称
    'drawType': 1, //1：合成报警视频保存画框， 0：合成报警视频不画框
    'flag': '20240224192743',//标记字段，当布控开启（合成报警视频同时保存画框和不画框）时有效，同一份报警信息会产生两份报警数据，该字段标识同一份报警信息
    'desc': 'desc|ignorevideo',//描述信息
    'videoCount': 1,//该报警数据产生的报警视频片段数量，数量对应的报警视频片段数据会保存在videoArray
    'videoArray': [
        {
            'index': 0, //视频序号
            'videoPath': "xx/2024/02/16/205307/1/205307.mp4",//报警视频片段在本机的存储路径
            'base64Str': "xxxxbase64xxx"//该报警视频片段的base64编码字符串
        }
    ],
    'imageCount': 2,//该报警数据产生的报警图片数量，数量对应的报警图片数据会保存在imageArray
    'imageArray': [
        {
            'index': 0, //图片序号
            'imagePath': "xx/2024/02/16/205307/1/205307.jpg",//该报警图片在本机的存储路径
            'base64Str': "xxxxbase64xxx"//该报警图片的base64编码字符串
        },
        {
            'index': 1, //图片序号
            'imagePath': "xx/2024/02/16/205307/1/205307_1.jpg",//该报警图片在本机的存储路径
            'base64Str': "xxxxbase64xxx"//该报警图片的base64编码字符串
        }
    ],
    'imageDetects': [
        [ //这里是第1张报警图片的检测结果数据
            {    
                'class_name': 'person', //检测到的目标分类名称
                'class_score': 0.77587890625, //目标分值
                'x1': 1604,             //目标检测框的x1坐标
                'y1': 611,              //目标检测框的y1坐标
                'x2': 1716,             //目标检测框的x2坐标
                'y2': 865               //目标检测框的y2坐标
            }
        ],
        [ //这里是第2张报警图片的检测结果数据
            {
                'class_name': 'person',
                'class_score': 0.77587890625,
                'x1': 1604,
                'x2': 1716,
                'y1': 611,
                'y2': 865
            },
            {
                'class_name': 'person',
                'class_score': 0.75927734375,
                'x1': 252,
                'x2': 372,
                'y1': 788,
                'y2': 1077
            }
        ]
    ],
    'extendParams': { //该参数的内容，由用户自己维护，具体位置在编辑报警接口（上传服务器内容扩展参数）字段

    },
    'createTime': '2024/02/24 19:42:44' //报警时间
}
```

## 2.2、获取所有摄像头数据

http://127.0.0.1:9001/open/getAllStreamData

```json
{
    "code": 1000,
    "msg": "success",
    "data": [
        {
            "code": "cam67540e7244",
            "app": "live",
            "name": "cam67540e7244",
            "pull_stream_type": 1,
            "pull_stream_transfer_mode": 0,
            "pull_stream_ip": "",
            "pull_stream_port": 0,
            "pull_stream_username": "",
            "pull_stream_password": "",
            "pull_stream_url": "rtsp://124.167.20.142:10554/openUrl/1qKmMRW",
            "nickname": "测试",
            "remark": "",
            "forward_state": 1,
            "create_time": "2024-08-20T09:09:24.845160",
            "last_update_time": "2024-08-20T09:09:24.845160",
            "add_type": 0,
            "state": 0,
            "is_audio": 0,
            "snap_filepath": "",
            "snap_time": "2024-08-20T09:09:24.845160",
            "camera_sum_num": 0,
            "camera_name": "",
            "camera_manufacturer": "",
            "camera_model": "",
            "camera_owner": "",
            "camera_device_id": "",
            "camera_parent_id": "",
            "camera_civilcode": "",
            "camera_last_keepalive_time": "2024-08-20T09:09:24.845160",
            "camera_last_register_time": "2024-08-20T09:09:24.845160"
        }
    ]
}
```

## 2.3、添加布控

http://127.0.0.1:9001/open/addControl

```json
{
    'controlCode': 'ct001', //自定义编号
    'streamCode': 'camb3caacc621576',//视频流编号（需要确保是系统中已经存在的视频流编号）
    'polygon': '0,0,1,0,1,1,0,1',//算法识别区域坐标数据 x1,y1,x2,y2,x3,y3,x4,y4 （每一个坐标点的取值范围 0<=p<=1）（v4.399新增）
    'polygonType': 1,//算法识别区域坐标类型 1:矩形 2:越线 （v4.399新增）
    'minInterval': 180, //报警间隔（单位秒），如果需要该参数是毫秒单位，请参考文档布控扩展参数
    'overlapThresh': '0.5',//重叠比例阈值
    'isPushStream': 1, //是否推流  0:算法处理的视频不推流，1:算法处理的视频推流
    "osdParams": "",//OSD贴图参数，具体如何设置参考：https://gitee.com/Vanishi/BXC_VideoAnalyzer_v4/wikis/布控扩展参数
    'extendParams': '',//扩展参数，具体如何设置参考：https://gitee.com/Vanishi/BXC_VideoAnalyzer_v4/wikis/布控扩展参数
    'alarmImageCount': 5,//图片数量
    'alarmMonitorDuration': 120,//时间范围
    'alarmDrawType': 0,//画框选项 0:合成报警视频只保存画框,1:合成报警视频同时保存画框和不画框
    'flowCode': 'flow1627f28955',//算法编号（v4.398新增）
    'audioCode': 'audio7d4fbb7b83329',//报警音频编号
    'alarmInterfaceCode': 'alarmIn23fc4e25475'//报警接口编号
}

```