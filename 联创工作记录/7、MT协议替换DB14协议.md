
| 煤矿名称 | 上报         | 上线进度   |
| ---- | ---------- | ------ |
| 后安   | 省煤监        | 2（前未上） |
| 担水沟  | 省煤监        | 3      |
| 东坡   | 省煤监        | 1      |
| 何家堡  | 省煤监、怀仁市应急局 | 4      |
| 吴家窑  | 省煤监、怀仁市应急局 | 5      |
| 焦煤矿  | 省煤监、怀仁市应急局 | 6      |
| 芦子沟  | 省煤监        |        |
| 峙峰山  | 省煤监        |        |
| 小峪   | 省煤监        |        |
| 王坪   | 省煤监        |        |
| 虎龙沟  | 省煤监        |        |
| 柴沟   | 省煤监        |        |
| 砂石矿  | 省煤监        |        |


安全监控

| DB14 | 文件名           |
| ---- | ------------- |
| AQCS | 安全监控系统初始化文件   |
| AQKJ | 安全监控系统空间数据文件  |
| AQMC | 模拟量传感器文件      |
| AQKC | 开关量传感器文件      |
| AQFZ | 安全监控系统分站文件    |
| AQDQ | 断电区域文件        |
| AQGX | 传感器关系文件       |
| AQSS | 30ｓ监测文件       |
| AQKD | 开关量变化文件       |
| AQLJ | 累计量文件         |
| AQMT | 模拟量每5min统计值文件 |
| AQBJ | 报警与断电文件       |
| AQKY | 馈电异常文件        |
| AQYC | 系统异常文件        |

| MT   | 文件名    |     |
| ---- | ------ | --- |
| CDDY | 测点定义   |     |
| FZDY | 分站定义   |     |
| CDSS | 测点实时数据 |     |
| TJSJ | 测点统计数据 |     |
| YCBJ | 测点异常数据 |     |
| FZSS | 分站实时数据 |     |
|      |        |     |
|      |        |     |


# 1、CDDY（测点定义）

## 1.1、请求头

| 序号  | 字段名     | 是否必录 |
| :-- | :------ | ---- |
| 1   | 煤矿编码    | √    |
| 2   | 矿井名称    | √    |
| 3   | 系统型号    |      |
| 4   | 系统名称    |      |
| 5   | 生产厂家名称  |      |
| 6   | 安全标志有效期 |      |
| 7   | 数据上传时间  | √    |

```
012020001;山西中煤东坡煤业有限公司;KJ95X;煤矿安全监控系统;天地（常州）自动化股份有限公司;2027-12-18;2024-05-30 07:28:17
```


## 1.2、请求体

| 序号  | 字段名     | 是否必录 |
| :-- | :------ | ---- |
| 1   | 测点编码    | √    |
| 2   | 系统编码    | √    |
| 3   | 分站编码    | √    |
| 4   | 传感器类型   | √    |
| 5   | 测点数值类型  | √    |
| 6   | 测点数值单位  |      |
| 7   | 高量程     |      |
| 8   | 低量程     |      |
| 9   | 上限报警门限  |      |
| 10  | 上限解报门限  |      |
| 11  | 下限报警门限  |      |
| 12  | 下限解报门限  |      |
| 13  | 上限断电门限  |      |
| 14  | 上限复电门限  |      |
| 15  | 下限断电门限  |      |
| 16  | 下限复电门限  |      |
| 17  | 开描述     |      |
| 18  | 停描述     |      |
| 19  | 测点安装位置  |      |
| 20  | 位置X     |      |
| 21  | 位置Y     |      |
| 22  | 位置Z     |      |
| 23  | 传感器关联关系 |      |
| 24  | 数据时间    | √    |

```
01202000101MN00071680;
01;
01202000100057;
0007;
MN;
m;
10;
0;
2.5;
2.4;
0.5;
0.6;
10;
10;
0;
0;
;
;
中央水泵房四号水仓;
;
;
;
;
2024-04-25 10:51:58
```

# 2、FZDY（分站定义）

## 2.1、请求头

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 煤矿编码   | √    |
| 2   | 矿井名称   | √    |
| 3   | 数据上传时间 | √    |
```
012020001;山西中煤东坡煤业有限公司;2024-05-30 07:30:41 ~
```

## 2.2、请求体

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 分站编码   | √    |
| 2   | 分站安装位置 | √    |
| 3   | X坐标    |      |
| 4   | Y坐标    |      |
| 5   | Z坐标    |      |

```
01202000100001;925运输顺槽;;;~
01202000100006;925备采面;;;~
01202000100007;输煤走廊;;;~
01202000100010;四煤配电室;;;~||
```


## 2.3、缺少字段

分站名称

# 3、CDSS（测点实时）

## 3.1、请求头

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 煤矿编码   | √    |
| 2   | 矿井名称   | √    |
| 3   | 数据上传时间 | √    |

```
012020001;山西中煤东坡煤业有限公司;2024-05-29 16:02:04~
```
## 3.2、请求体

| 序号  | 字段名     | 是否必录 |
| :-- | :------ | ---- |
| 1   | 测点编码    | √    |
| 2   | 传感器类型名称 | √    |
| 3   | 测点安装位置  | √    |
| 4   | 测点值     | √    |
| 5   | 测点数值单位  |      |
| 6   | 测点状态    | √    |
| 7   | 数据时间    | √    |

```
01202000101KG10091106;断电器;926运输顺槽660v远控开关断电状态;1;;0;2024-05-29 16:02:04~
01202000101KG10091103;断电器;926运输顺槽主扇远控开关断电状态;1;;0;2024-05-29 16:02:04~
```

# 4、YCBJ（异常报警）

## 4.1、请求头

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 煤矿编码   | √    |
| 2   | 矿井名称   | √    |
| 3   | 数据上传时间 | √    |

## 4.2、请求体

| 序号  | 字段名     | 是否必录 |
| :-- | :------ | ---- |
| 1   | 测点编码    | √    |
| 2   | 传感器类型名称 | √    |
| 3   | 测点安装位置  | √    |
| 4   | 测点数值单位  |      |
| 5   | 异常类型    | √    |
| 6   | 异常开始时间  |      |
| 7   | 异常结束时间  |      |
| 8   | 异常期间最大值 | √    |
| 9   | 最大值时刻   | √    |
| 10  | 异常期间最小值 | √    |
| 11  | 最小值时刻   | √    |
| 12  | 异常期间平均值 |      |
| 13  | 异常原因    |      |
| 14  | 处理措施    |      |
| 15  | 录入时间    |      |
| 16  | 录入人     |      |
| 17  | 数据时间    | √    |

```
01202000101MN0043587;激光甲烷;901运输顺槽掘进面激光甲烷T1;%CH4;004;2024-05-30 09:53:16;;;;;;;;;;;2024-05-30 09:53:23~||
```

```
01202000101MN0043587;激光甲烷;901运输顺槽掘进面激光甲烷T1;%CH4;004;2024-05-30 09:53:16;2024-05-30 09:53:36;;;;;;;;;;2024-05-30 09:53:44~||
```

## 4.3、上报应急局

1、获取未结束的报警
2、更新最大最小平均值等
3、获取最近5分钟变更的结束告警数据
4、拼接未结束数据 + 最近5分钟变更的结束告警数据
5、遍历list，未匹配到gas_base则跳过
6、转化报警类型 ycType
7、



# 5、FZSS（分站实时）

## 5.1、请求头

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 煤矿编码   | √    |
| 2   | 矿井名称   | √    |
| 3   | 数据上传时间 | √    |

## 5.2、请求体

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 分站编码   | √    |
| 2   | 分站运行状态 | √    |
| 3   | 分站供电状态 | √    |
| 4   | 数据时间   | √    |


# 6、TJSJ（统计数据）

## 6.1、请求头

| 序号  | 字段名    | 是否必录 |
| :-- | :----- | ---- |
| 1   | 煤矿编码   | √    |
| 2   | 矿井名称   | √    |
| 3   | 数据上传时间 | √    |

## 6.2、请求体

| 序号  | 字段名     | 是否必录 |
| :-- | :------ | ---- |
| 1   | 测点编码    | √    |
| 2   | 传感器类型名称 | √    |
| 3   | 测点安装位置  | √    |
| 4   | 测点数值单位  | √    |
| 5   | 开始时间    | √    |
| 6   | 结束时间    | √    |
| 7   | 最大值     | √    |
| 8   | 最大值时刻   | √    |
| 9   | 最小值     | √    |
| 10  | 最小值时刻   | √    |
| 11  | 平均值     | √    |
| 12  | 数据时间    | √    |


# 7、DB14和MT对比

| DB14                      | MT         | 应急局  | 生成频率(MT)           | 入库               |     |
| :------------------------ | :--------- | ---- | ------------------ | ---------------- | --- |
| AQFZ（分站）                  | FZDY       | FZXX | 有变化时上传<br>至少每天一次   | gas_station_info |     |
| AQMC（模拟量传感器）、AQKC（开关量传感器） | CDDY       | CDDY | 有变化时上传<br>至少每天一次   | gas_base_info    |     |
| AQSS（安全实时）                | CDSS       | SSSJ | 1min               | gas_real         |     |
| AQBJ（安全报警）、AQYC（安全异常）     | YCBJ       | YCBJ | 发生时开始上传<br>发生期间20s | gas_alarm        |     |
| AQCS（系统初始化）               |            |      |                    | gas_aqcs         |     |
| AQKJ（空间数据）                |            |      |                    |                  |     |
| AQDQ（断电区域）                |            |      |                    |                  |     |
| AQGX（传感器关系）               |            |      |                    |                  |     |
| AQKD（开关量变化）               |            |      |                    |                  |     |
| AQLJ（累积量）                 |            |      |                    |                  |     |
| AQMT（模拟量5min）             |            |      |                    |                  |     |
| AQKY（馈电异常）                |            |      |                    |                  |     |
|                           | TJSJ（统计数据） |      | 5min               |                  |     |
|                           | FZSS（分站实时） |      | 1min               |                  |     |


# 配置

## 配置文件

gas-etl

```yml
localsftp:  
    monitor-mt-dir: /upload/gas_mt/  # mt读取目录
reportInfo:  
    fileType: 2 #0-xml 1-txt 2-MT
    backupBaseDir-MT: /upload/backupMT
    mt-analysis-validate: FZDY,CDDY,CDSS,YCBJ
    redo-report-sj:
	    all: 0 # 默认为0。1: 全补, 0: 指定补几天的，需配置days，默认只补今天和昨天的
        days: 0
    redo-report-yj:
	    all: 0 # 默认为0。1: 全补, 0: 指定补几天的，需配置days，默认只补今天和昨天的
        days: 0
mt-ftp:  
    report-dir: /mt1201/source/aqjk/140602012771   # 省局目录
    ip: 76.10.2.220  
    port: 2222  
    username: jyiot  
    password: jyiot123
gas-verification:
	gas-alarm-physics-code: 0001-0.8,0043-0.8,0004-0.8,0038-0.8,0012-1.0 #甲烷，激光甲烷，一氧化碳，管道一氧化碳，氧气
```

home

```yml
reportInfo:  
    fileType: 2
```



数据库

## 数据库

```
	ALTER TABLE gas_real MODIFY COLUMN sensor_code varchar(64);
	ALTER TABLE gas_alarm MODIFY COLUMN sensor_code varchar(64);
```

## 调试命令

```sql
delete from gas_base_info where create_time > '2024-06-01';
delete from gas_station_info where update_time > '2024-06-01';
delete from gas_alarm where record_name > '2024-06-01';
truncate table gas_real;
```


## 上线后修改

1、瓦斯报警-实时报警监控：redis中删除GAS的key
2、手动同步gas_alarm_config,调用接口：http://172.30.1.152:30183/gas/alarm/config/synchronous
