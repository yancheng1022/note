// 短信
TencentSmsUtil.SmsSingleSender(phone, TencentUtil.appId, TencentUtil.appkey, TencentUtil.remindTemplateId, TencentUtil.smsSign, params);

// 微信
weixinUserInfoService.pushAlarmInfoMsg(mineName, "领导带班空岗", new DateTime().toString(), detail + ", 请及时查看预警信息并处理");

// 钉钉
DingTalkUtil.sendDingTalk(personNoticeTypeEntity.getNoticeUrl(), msg, personNoticeTypeEntity.getNoticePhones().split(","));

超限
中断  是否区分人员和瓦斯
空岗
数据核查


| 序号  | 模块  | 菜单名称                        | 位置                                               | 完成情况 |
| :-- | :-- | :-------------------------- | ------------------------------------------------ | ---- |
| 1   | 安全  | 超限                          | GasAlarmConfigServiceImpl.gasAlarmCheckAndNotice | 完成   |
| 2   | 人员  | 空岗                          | PersonVacancyServiceImpl.saveVacanInfo           | 完成   |
| 3   | 安全  | 中断                          | ReportYjInterruptTask.sendYjSms                  | 完成   |
| 4   | 人员  | 中断                          | ReportYjInterruptTask.sendYjSms                  |      |
| 5   | 安全  | 报警文件中不存在实时数据                |                                                  |      |
| 6   | 安全  | 报警文件未上传报警结束时间               |                                                  |      |
| 7   | 安全  | 数据上传种类是否齐全                  |                                                  |      |
| 8   | 安全  | 信息不全：无传感器地点名称               |                                                  |      |
| 9   | 安全  | 信息不全：无报警门限值                 |                                                  |      |
| 10  | 安全  | 信息不全：无传感器类型                 |                                                  |      |
| 11  | 安全  | 信息不全：传感器命名相同或为其它或为空，或为模糊性地点 |                                                  |      |
| 12  | 人员  | 领导信息上传错误导致带班空岗              |                                                  |      |
| 13  | 人员  | 数据上传种类是否齐全                  |                                                  |      |
| 14  | 人员  | 是否存在超员                      |                                                  |      |
| 15  | 人员  | 是否存在疑似睡岗                    |                                                  |      |


```java
Set<String> phones = Arrays.stream(personNoticeTypeEntity.getNoticePhones().split(",")).collect(Collectors.toSet());  
// 灵活预警 - 空岗  
if("1".equals(personNoticeTypeEntity.getCustomerNoticeState()) && StringUtils.isNotEmpty(personNoticeTypeEntity.getCustomerNoticePhones())){  
    phones.addAll(Arrays.stream(personNoticeTypeEntity.getCustomerNoticePhones().split(",")).collect(Collectors.toSet()));  
}
```



# 2、sql备份

```sql
-- 增加字段customer_notice_phones
ALTER TABLE notice_alarm_setting
ADD customer_notice_phones VARCHAR(255) 
comment '通知客户人员手机号，多个英文逗号分隔' AFTER notice_phones ;

-- 增加字段customer_notice_state
ALTER TABLE notice_alarm_setting
ADD customer_notice_state VARCHAR(8) 
DEFAULT '0'
comment '通知客户人员手机号，多个英文逗号分隔' AFTER notice_state ;

-- 通知类型（客户|内部）
ALTER TABLE notice_alarm_setting
ADD notice_type VARCHAR(8) 
comment '通知类型（0-内部，1-客户）' AFTER type;

-- 初始化历史数据（内部）通知类型
update notice_alarm_setting set notice_type = '0'

-- 报警文件中不存在实时数据
INSERT INTO notice_alarm_setting (`module_name`, `type`, `notice_url`, `notice_phones`, `customer_notice_phones`, `notice_state`, `customer_notice_state`, `notice_end_state`, `notice_middle_state`, `scene_type`, `scene_name`, `notice_rate`, `notice_unit`, `notice_last_time`) VALUES ('AQ', '1', 'https://yun.tim.qq.com/v5/tlssmssvr/sendsms', NULL, NULL, '0', '0', '0', '0', '20', '报警文件中不存在实时数据', '30', '分钟', NULL);

-- 报警文件未上传报警结束时间
INSERT INTO notice_alarm_setting (`module_name`, `type`, `notice_url`, `notice_phones`, `customer_notice_phones`, `notice_state`, `customer_notice_state`, `notice_end_state`, `notice_middle_state`, `scene_type`, `scene_name`, `notice_rate`, `notice_unit`, `notice_last_time`) VALUES ('AQ', '1', 'https://yun.tim.qq.com/v5/tlssmssvr/sendsms', NULL, NULL, '0', '0', '0', '0', '21', '报警文件未上传报警结束时间', '30', '分钟', NULL);

-- 数据上传种类不齐全
INSERT INTO notice_alarm_setting (`module_name`, `type`, `notice_url`, `notice_phones`, `customer_notice_phones`, `notice_state`, `customer_notice_state`, `notice_end_state`, `notice_middle_state`, `scene_type`, `scene_name`, `notice_rate`, `notice_unit`, `notice_last_time`) VALUES ('AQ', '1', 'https://yun.tim.qq.com/v5/tlssmssvr/sendsms', NULL, NULL, '0', '0', '0', '0', '22', '数据上传种类不齐全', '30', '分钟', NULL);

```



