
验证码需要客户提供  
https://119.164.254.72:54491  
https://119.164.254.72:51234


# 2、慢sql查询

----------------------------------- sql 1 ---------------------------------------------------------------
-- 原始表执行计划
explain UPDATE `hycca_3.0`.LT114_contact_inquiries_info_202512 AS lt114 JOIN `hycca_3.0`.LT114_r_c_e AS voice ON lt114.field02 = voice.session_id SET lt114.start_time = voice.start_time, lt114.end_time = voice.end_time, lt114.call_duration = voice.duration WHERE voice.start_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);

-- 修改field02类型，添加field02索引
ALTER TABLE `hycca_3.0`.a_lt114_contact_inquiries_info_202512 
MODIFY COLUMN `field02` bigint DEFAULT NULL COMMENT '预留字段02';
ALTER TABLE `a_lt114_contact_inquiries_info_202512` 
ADD INDEX idx_field02 (field02);

explain UPDATE `hycca_3.0`.a_LT114_contact_inquiries_info_202512 AS lt114 JOIN `hycca_3.0`.a_LT114_r_c_e AS voice ON lt114.field02 = voice.session_id SET lt114.start_time = voice.start_time, lt114.end_time = voice.end_time, lt114.call_duration = voice.duration WHERE voice.start_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);


----------------------------------- sql 2 ---------------------------------------------------------------
-- 原始执行计划
explain UPDATE `hycca_3.0`.LT114_contact_inquiries_info_202512 AS lt114 JOIN `hycca_3.0`.LT114_voice_call_result_data AS voice ON lt114.field02 = voice.session_id SET lt114.start_time = voice.start_time, lt114.end_time = voice.end_time, lt114.call_type = voice.call_type, lt114.caller_id = CASE WHEN voice.call_type = 1 THEN voice.local_url WHEN voice.call_type = 0 THEN voice.remote_url ELSE lt114.caller_id END, lt114.called_number = CASE WHEN voice.call_type = 1 THEN voice.remote_url WHEN voice.call_type = 0 THEN voice.local_url ELSE lt114.called_number END, lt114.call_duration = TIMESTAMPDIFF(SECOND, voice.start_time, voice.end_time), lt114.end_type_code = voice.end_type_code, lt114.end_type_name = voice.end_type_name, lt114.keypress_code = voice.keypress_code, lt114.keypress_name = voice.keypress_name, lt114.contact_mode = CASE WHEN voice.end_type_code = 1001 THEN '智能客服' ELSE '人工客服' END WHERE voice.start_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);

-- 添加索引
ALTER TABLE `a_LT114_voice_call_result_data` 
ADD INDEX idx_session_id (session_id);

-- 修复后执行计划
explain UPDATE `hycca_3.0`.a_LT114_contact_inquiries_info_202512 AS lt114 JOIN `hycca_3.0`.a_LT114_voice_call_result_data AS voice ON lt114.field02 = voice.session_id SET lt114.start_time = voice.start_time, lt114.end_time = voice.end_time, lt114.call_type = voice.call_type, lt114.caller_id = CASE WHEN voice.call_type = 1 THEN voice.local_url WHEN voice.call_type = 0 THEN voice.remote_url ELSE lt114.caller_id END, lt114.called_number = CASE WHEN voice.call_type = 1 THEN voice.remote_url WHEN voice.call_type = 0 THEN voice.local_url ELSE lt114.called_number END, lt114.call_duration = TIMESTAMPDIFF(SECOND, voice.start_time, voice.end_time), lt114.end_type_code = voice.end_type_code, lt114.end_type_name = voice.end_type_name, lt114.keypress_code = voice.keypress_code, lt114.keypress_name = voice.keypress_name, lt114.contact_mode = CASE WHEN voice.end_type_code = 1001 THEN '智能客服' ELSE '人工客服' END WHERE voice.start_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);


----------------------------------- sql 3 ---------------------------------------------------------------
explain UPDATE LT114_recent_20_reported_info AS lt114 JOIN `hycca_3.0`.LT114_voice_call_result_data AS voice ON lt114.field03 = voice.session_id SET lt114.field02 = voice.end_type_code, lt114.service_mode = voice.end_type_name WHERE voice.end_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);

ALTER TABLE `hycca_3.0`.a_LT114_recent_20_reported_info 
MODIFY COLUMN `field03` bigint DEFAULT NULL COMMENT '预留字段03';
ALTER TABLE `a_LT114_recent_20_reported_info` 
ADD INDEX idx_field03 (field03);

explain UPDATE a_LT114_recent_20_reported_info AS lt114 JOIN `hycca_3.0`.a_LT114_voice_call_result_data AS voice ON lt114.field03 = voice.session_id SET lt114.field02 = voice.end_type_code, lt114.service_mode = voice.end_type_name WHERE voice.end_time >= DATE_SUB(NOW(), INTERVAL 10 MINUTE);


----------------------------------- sql 5 ---------------------------------------------------------------
explain REPLACE INTO `a_LT114_voice_call_result_data` ( `session_id`, `call_type`, `call_method`, `channel_type`, `start_time`, `end_time`, `resource_id`, `resource_dn`, `resource_name`, `remote_url`, `local_url`, `queue_duration`, `ring_duration`, `talk_duration`, `acw_duration`, `first_skill_group_id`, `first_skill_group_name`, `skill_group_id`, `skill_group_name`, `keypress_code`, `keypress_name`, `end_type_code`, `end_type_name`, `att_detail`, `record_url` ) VALUES ( 7955980959454226932, 0, 1, 0, '2025-12-29 21:52:48', '2025-12-29 21:53:17', '1', '1', '1', '13869231204', '1140534', 0, 0, 0, 0, null, null, 0, null, null, null, 1001, 'IVR挂断', null, null );

EXPLAIN SELECT * FROM `a_LT114_voice_call_result_data`
WHERE `session_id` = 7955980959454226932 
  AND `call_type` = 0 
  AND `resource_id` = '1'
  AND `end_type_code` = 1001
  AND `start_time` = '2025-12-29 21:52:48'
  AND `end_time` = '2025-12-29 21:53:17';