

# 0、环境地址信息

## 0.1、vpn

堡垒机地址：https://cbh.chinagasholdings.com/  
VPN:用IE浏览器输入服务器地址：116.31.111.59  
下载SSL VPN客户端
wf/Gas#*20200858

## 0.2、SOA账密
"智能呼叫中心系统"SOA测试环境使用账号/密码：  
     账号：OSB_DEV_AICC  
     密码：AiccWx2#86  
 "智能呼叫中心系统"SOA正式环境使用账号/密码：  
     账号：OSB_PRD_AICC  
     密码：AiccPrdSq9#86  
请注意信息安全，保管好账号密码


对接组织架构、数据应该是定时同步、实现单点登录。数据权限，要按照人员角色来划分


# 1、应用系统集成

身份主数据分发（员工、机构、岗位）
开通/回收应用系统账号
单点登录集成


# 2、IMA身份主数据定时同步集成规范

1.身份主数据接口服务
http://172.26.0.137:6011/services/2F06402000001    鉴权账号密码需要应用方自行向SOA申请（Basic Auth的鉴权方式）

（1）人员接口字段（RYXX）
（2）组织（部门）接口字段（ZZJG）
（3）人员组织关系接口字段（RYZZGX）
（4）职务（岗位）接口字段（MDM_RYZW_QUERY）
（5）组织-流程角色（LCJS）


# 3、IAM_OAUTH2单点登录协议集成规范

授权码模式（code - token）
简单模式（暴露token）
密码模式（用户向客户端提供用户名密码）
客户端模式（客户端的密钥，id获取token）

## 3.1、流程
1. 用户访问的系统 → 跳转到IAM认证页（带参数）
2. 用户在IAM页登录 → IAM返回`code`到你的回调地址
3. 系统用`code`换取`access_token`
4. 用`access_token`获取用户信息（如用户名、角色等）
5. 用户成功登录系统


1、接口
IAM系统中注册之后会提供client_id和client_secret
1、请求授权接口：https://认证中心域名/idp/authCenter/authenticate
2、获取授权接口：https://认证中心域名/idp/api/v3/oauth2/token
3、刷新授权接口：https://认证中心域名/idp/api/v3/oauth2/token
4、查询授权接口：https://认证中心域名/idp/api/v3/oauth2/tokenInfo
5、回收授权接口：https://认证中心域名/idp/v3/oauth2/revoke
6、授权接口有效性校验：https://认证中心域名/idp/api/v3/oauth2/introspect
7、获取用户信息接口：https://认证中心域名/idp/api/v3/oauth2/userInfo

2、一人多账号

3、逃生机制集成


# 4、数据同步信息汇总





# 4、问题


李智荣
1、关于接口调用方式： 各接口抽取数据时，需先进行首次调用访问。首次调用访问时批次号和历史批次号传空，startTime和endTime传时间日期，访问之后IAM会返回两个批次号（批次号和历史批次号）和一个totalCount(总页数)，后续访问传IAM给出的批次号、历史批次号、信息，遍历按照总页数去遍历循环每一页数据，从第一页开始（pageNumber=0是第一页），循环取出数据。




# 5、开发

## 5.1、表结构

CREATE TABLE iam_sync_batch (
    id int(11) AUTO_INCREMENT PRIMARY KEY,
    sync_type VARCHAR(32) NOT NULL COMMENT '同步类型: RYXX(人员), ZZJG（组织）, RYZZGX（人员-组织）, MDM_RYZW_QUERY（职务）,LCJS（角色）',
    batch VARCHAR(200) NOT NULL COMMENT '当前批次号',
    batch_history VARCHAR(200) NOT NULL COMMENT '历史批次号',
    total_count INT DEFAULT 0 COMMENT '总记录数',
    sync_status TINYINT DEFAULT 0 COMMENT '状态: 0-同步中, 1-同步成功, 2-同步失败',
    start_time varchar(32)  COMMENT '开始时间',
    end_time varchar(32) COMMENT'结束时间',
    created_time varchar(32) COMMENT '创建时间',
    updated_time varchar(32) COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT 'IAM同步批次信息表';